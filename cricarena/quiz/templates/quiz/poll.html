{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trending Cricket Polls</title>
    <link rel="stylesheet" href="{% static 'quiz/poll.css' %}">
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />


</head>
<body>

      {% include 'quiz/navbar.html' %}


<h2  class = "center-heading" >ðŸ”¥ Trending Cricket Polls</h2>

<div class="swiper poll-slider">
  <div class="swiper-wrapper">
    {% for poll in polls %}
    <div class="swiper-slide poll-card" id="poll-{{ poll.id }}">
      <h3>{{ poll.question }}</h3>
      {% for option in poll.options.all %}
      <button class="option-button" onclick="vote('{{ option.id }}', '{{ poll.id }}')">
        {{ option.text }}
      </button>
      {% endfor %}
      <div class="results" style="display: none;">
        {% for option in poll.options.all %}
        <div>
          <div>{{ option.text }}</div>
          <div class="result-bar">
            <div class="fill" style="width:0%; background: #1db954;">0%</div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Swiper arrows -->
  <div class="swiper-button-prev"></div>
  <div class="swiper-button-next"></div>
</div>


<!-- Include the quiz -->
<div class="quiz-section">
  {% include 'quiz/quiz.html' %}
</div>

<!-- <script src="{% static 'quiz/poll.js' %}"></script> -->    

<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

<script>

    const swiper = new Swiper('.poll-slider', {
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    slidesPerView: 'auto',
    spaceBetween: 20,
  });

function vote(optionId, pollId) {
    // fetch(`/vote/${optionId}/`)
    fetch(`/quiz/vote/${optionId}/`)
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                showResults(pollId, data.results);
            }
        });
}

function showResults(pollId, results) {
    const pollCard = document.getElementById(`poll-${pollId}`);
    const resultsDiv = pollCard.querySelector('.results');
    const buttons = pollCard.querySelectorAll('.option-button');

    // Hide buttons
    buttons.forEach(btn => btn.style.display = 'none');

    // Show results
    resultsDiv.style.display = 'block';

    // Update result bars
    const fills = resultsDiv.querySelectorAll('.fill');
    results.forEach((result, idx) => {
        const fill = fills[idx];

        // Reset width to 0 to prepare for animation
        fill.style.width = '0%';
        fill.textContent = ''; // Hide text initially

        // Force browser to render the initial state
        void fill.offsetWidth;  // ðŸ‘ˆ forces a reflow

        setTimeout(() => {
            fill.style.width = result.percent + '%';
        }, 50);

        // Show text after animation (match transition duration: 0.8s)
        setTimeout(() => {
            fill.textContent = ` (${result.percent.toFixed(1)}%)`;
        }, 850);
    });
}

</script>

</div><!-- In your page.html -->
</body>
</html>
